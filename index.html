<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"> <!-- Added user-scalable=no, might help -->
    <title>Sudoku</title> <!-- Simplified title -->
    <style>
        /* Basic Reset & High Contrast Body */
        html, body {
            margin: 0;
            padding: 0;
            height: 100%; /* Attempt to constrain height */
             /* --- Force no scrollbars (Use with caution!) --- */
            overflow: hidden !important;
             /* ------------------------------------------------ */
        }

        body {
            font-family: sans-serif;
            background-color: white;
            color: black;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            /* Add padding directly to body if needed, instead of margin */
            padding: 5px;
            box-sizing: border-box; /* Include padding in element's total width/height */
        }

        /* Centering Container - Very Wide */
        .container {
            text-align: center;
            max-width: 1300px; /* Increased max-width */
            margin: 0 auto; /* Still useful for centering within the viewport if viewport is wider */
            /* Remove height constraints here if body handles overflow */
        }

        /* REMOVED h1 styles */

        /* Top Controls Area */
        .top-controls {
            margin: 5px 0; /* Reduced margin slightly */
        }

        /* Sudoku Grid Table - Large Size & Borders */
        #sudoku-grid {
            border-collapse: collapse;
            margin: 8px auto; /* Adjusted margin */
            border: 5px solid black; /* Increased outer border */
        }

        #sudoku-grid td {
            border: 2px solid #aaa; /* Increased inner borders */
            width: 84px;  /* Large size */
            height: 84px; /* Large size */
            text-align: center;
            vertical-align: middle;
            font-size: 45px; /* Increased font size */
            cursor: default;
        }

        /* Classes for thicker 3x3 box borders - Thickened proportionally */
        .thick-border-top { border-top: 5px solid black !important; }
        .thick-border-bottom { border-bottom: 5px solid black !important; }
        .thick-border-left { border-left: 5px solid black !important; }
        .thick-border-right { border-right: 5px solid black !important; }

        /* Cell Styling */
        .cell-given {
            font-weight: bold;
            background-color: #eee; /* Light grey for given numbers */
            color: black;
        }

        .cell-editable {
            cursor: pointer;
            color: #333; /* Dark grey for user input */
            background-color: white;
        }

        .cell-selected {
            background-color: #ccc !important; /* Medium grey highlight */
        }

        /* Inverted Error Cell Styling */
        .cell-error {
            background-color: black !important; /* Black background for errors */
            color: white !important; /* White text for errors */
            font-weight: bold; /* Make error numbers stand out more */
        }

        /* Bottom Controls Area - Allowing wrapping */
        .bottom-controls {
            margin: 10px 0 5px 0; /* Adjusted margin */
            text-align: center;
        }

        /* General Button & Select Styling */
        button, select {
            font-size: 14px;
            padding: 6px 8px;
            margin: 3px;
            min-width: 35px;
            border: 1px solid black;
            background-color: #eee;
            cursor: pointer;
            display: inline-block;
            vertical-align: middle;
            box-sizing: border-box;
        }

         button:active, select:active {
             background-color: #ccc;
        }

        /* Specific Styling for LARGE Number/Clear Buttons */
        .input-num-button {
             width: 65px;
             height: 50px;
             font-size: 20px;
             padding: 5px;
             line-height: 40px;
             margin: 4px;
        }

        /* Styling for Check Button (standard size) */
        .check-button {
             padding: 8px 12px;
        }

        /* Label Styling */
         label {
             margin-right: 3px;
             vertical-align: middle;
             font-size: 14px;
         }


        /* Message Area */
        #message {
            margin-top: 5px; /* Reduced margin */
            margin-bottom: 5px;
            font-size: 14px;
            min-height: 1.2em;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <div class="container">
        <!-- h1 removed -->

        <!-- Top Controls: Difficulty and New Game -->
        <div class="top-controls">
            <label for="difficulty">Difficulty:</label>
            <select id="difficulty">
                <option value="easy">Easy</option>
                <option value="medium" selected>Medium</option>
                <option value="hard">Hard</option>
            </select>
            <button onclick="startGame()">New Game</button>
        </div>

        <div id="message">Loading Grid... Select difficulty and start a new game.</div>

        <table id="sudoku-grid">
            <!-- Grid structure rendered on load by JS -->
        </table>

        <!-- Bottom Controls: Number Input, Clear, Check (will wrap) -->
        <div class="bottom-controls">
            <button class="input-num-button" onclick="inputNumber(1)">1</button>
            <button class="input-num-button" onclick="inputNumber(2)">2</button>
            <button class="input-num-button" onclick="inputNumber(3)">3</button>
            <button class="input-num-button" onclick="inputNumber(4)">4</button>
            <button class="input-num-button" onclick="inputNumber(5)">5</button>
            <button class="input-num-button" onclick="inputNumber(6)">6</button>
            <button class="input-num-button" onclick="inputNumber(7)">7</button>
            <button class="input-num-button" onclick="inputNumber(8)">8</button>
            <button class="input-num-button" onclick="inputNumber(9)">9</button>
            <button class="input-num-button" onclick="clearNumber()">Clear</button>
            <button class="check-button" onclick="checkSolution()">Check</button>
        </div>
    </div>

    <script type="text/javascript">
        // --- Sudoku Logic (ES3 Compatible) ---
        // (JavaScript code remains exactly the same as the previous version)

        var SIZE = 9;
        var BOX_SIZE = 3;

        var currentPuzzle = null;
        var currentSolution = null;
        var userBoard = null;

        var selectedCell = { row: -1, col: -1, element: null };

        var difficultySettings = {
            'easy': 40,
            'medium': 46,
            'hard': 51,
            'expert': 56
        };

        // --- Utility Functions ---
        function shuffleArray(array) {
            var currentIndex = array.length, temporaryValue, randomIndex;
            while (0 !== currentIndex) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex -= 1;
                temporaryValue = array[currentIndex];
                array[currentIndex] = array[randomIndex];
                array[randomIndex] = temporaryValue;
            }
            return array;
        }

        function createEmptyBoard() {
            var board = [];
            for (var r = 0; r < SIZE; r++) {
                board[r] = [];
                for (var c = 0; c < SIZE; c++) {
                    board[r][c] = 0;
                }
            }
            return board;
        }

        function copyBoard(board) {
            var newBoard = [];
            for (var r = 0; r < SIZE; r++) {
                newBoard[r] = [];
                for (var c = 0; c < SIZE; c++) {
                    newBoard[r][c] = board[r][c];
                }
            }
            return newBoard;
        }

        // --- Core Sudoku Logic ---
        function findEmpty(board) {
            for (var r = 0; r < SIZE; r++) {
                for (var c = 0; c < SIZE; c++) {
                    if (board[r][c] === 0) {
                        return { row: r, col: c };
                    }
                }
            }
            return null;
        }

        function isValid(board, row, col, num) {
            // Check row
            for (var c = 0; c < SIZE; c++) {
                if (board[row][c] === num && c !== col) {
                    return false;
                }
            }
            // Check column
            for (var r = 0; r < SIZE; r++) {
                if (board[r][col] === num && r !== row) {
                    return false;
                }
            }
            // Check 3x3 box
            var boxStartRow = Math.floor(row / BOX_SIZE) * BOX_SIZE;
            var boxStartCol = Math.floor(col / BOX_SIZE) * BOX_SIZE;
            for (var r = 0; r < BOX_SIZE; r++) {
                for (var c = 0; c < BOX_SIZE; c++) {
                    if (board[boxStartRow + r][boxStartCol + c] === num && (boxStartRow + r !== row || boxStartCol + c !== col)) {
                        return false;
                    }
                }
            }
            return true;
        }

        function solveSudoku(board) {
            var emptyPos = findEmpty(board);
            if (!emptyPos) {
                return true;
            }
            var row = emptyPos.row;
            var col = emptyPos.col;
            var nums = shuffleArray([1, 2, 3, 4, 5, 6, 7, 8, 9]);
            for (var i = 0; i < nums.length; i++) {
                var num = nums[i];
                if (isValid(board, row, col, num)) {
                    board[row][col] = num;
                    if (solveSudoku(board)) {
                        return true;
                    }
                    board[row][col] = 0;
                }
            }
            return false;
        }

        // --- Puzzle Generation ---
        function generatePuzzle(difficulty) {
            setMessage("Generating puzzle... (may take a while)");
            setTimeout(function() {
                currentSolution = createEmptyBoard();
                if (!solveSudoku(currentSolution)) {
                     setMessage("Error: Failed to generate a solution.");
                     return;
                }
                currentPuzzle = copyBoard(currentSolution);
                var cellsToRemove = difficultySettings[difficulty] || difficultySettings['medium'];
                var attempts = cellsToRemove * 2;
                var removed = 0;
                while (removed < cellsToRemove && attempts > 0) {
                    var r = Math.floor(Math.random() * SIZE);
                    var c = Math.floor(Math.random() * SIZE);
                    if (currentPuzzle[r][c] !== 0) {
                        currentPuzzle[r][c] = 0;
                        removed++;
                    }
                    attempts--;
                }
                userBoard = copyBoard(currentPuzzle);
                renderBoard();
                setMessage("New game started. Select a cell to input numbers.");
                clearSelection();
            }, 50);
        }

        // --- UI Rendering ---
        function renderBoard() {
            var table = document.getElementById('sudoku-grid');
            table.innerHTML = '';
            for (var r = 0; r < SIZE; r++) {
                var tr = document.createElement('tr');
                for (var c = 0; c < SIZE; c++) {
                    var td = document.createElement('td');
                    var val = userBoard ? userBoard[r][c] : 0;
                    var puzzleVal = currentPuzzle ? currentPuzzle[r][c] : 0;

                    td.innerHTML = val === 0 ? '' : val.toString();
                    td.className = 'cell';

                    if (r === 0) td.className += ' thick-border-top';
                    if ((r + 1) % BOX_SIZE === 0 && r !== SIZE - 1) td.className += ' thick-border-bottom';
                    if (c === 0) td.className += ' thick-border-left';
                    if ((c + 1) % BOX_SIZE === 0 && c !== SIZE - 1) td.className += ' thick-border-right';
                    if (r === SIZE - 1) td.className += ' thick-border-bottom';
                    if (c === SIZE - 1) td.className += ' thick-border-right';

                    if (puzzleVal !== 0) {
                        td.className += ' cell-given';
                    } else {
                        td.className += ' cell-editable';
                        td.onclick = (function(row, col, element) {
                            return function() {
                                selectCell(row, col, element);
                            };
                        })(r, c, td);
                    }
                    tr.appendChild(td);
                }
                table.appendChild(tr);
            }
        }

        function renderEmptyGridFrame() {
             var table = document.getElementById('sudoku-grid');
             table.innerHTML = '';
             for (var r = 0; r < SIZE; r++) {
                var tr = document.createElement('tr');
                for (var c = 0; c < SIZE; c++) {
                    var td = document.createElement('td');
                    td.innerHTML = ' ';
                    td.className = 'cell cell-editable';

                    if (r === 0) td.className += ' thick-border-top';
                    if ((r + 1) % BOX_SIZE === 0 && r !== SIZE - 1) td.className += ' thick-border-bottom';
                    if (c === 0) td.className += ' thick-border-left';
                    if ((c + 1) % BOX_SIZE === 0 && c !== SIZE - 1) td.className += ' thick-border-right';
                    if (r === SIZE - 1) td.className += ' thick-border-bottom';
                    if (c === SIZE - 1) td.className += ' thick-border-right';

                    tr.appendChild(td);
                }
                table.appendChild(tr);
            }
            setMessage("Select difficulty and press 'New Game'.");
        }


        // --- UI Interaction ---
        function setMessage(msg) {
            document.getElementById('message').innerHTML = msg;
        }

        function clearSelection() {
             if (selectedCell.element) {
                selectedCell.element.className = selectedCell.element.className.replace(/\bcell-selected\b/g, '');
             }
             selectedCell.row = -1;
             selectedCell.col = -1;
             selectedCell.element = null;
        }

        function selectCell(row, col, element) {
            if (!userBoard || !currentPuzzle || currentPuzzle[row][col] !== 0) return;
            clearSelection();
            selectedCell.row = row;
            selectedCell.col = col;
            selectedCell.element = element;
            if (element.className.indexOf('cell-selected') === -1) {
                 element.className += ' cell-selected';
            }
        }

        function inputNumber(num) {
            if (selectedCell.row === -1 || !selectedCell.element) {
                setMessage("Please select an empty cell first.");
                return;
            }
            if (currentPuzzle[selectedCell.row][selectedCell.col] !== 0) {
                setMessage("Cannot change initial puzzle numbers.");
                return;
            }
            var r = selectedCell.row;
            var c = selectedCell.col;
            userBoard[r][c] = num;
            selectedCell.element.innerHTML = num.toString();
            selectedCell.element.className = selectedCell.element.className.replace(/\bcell-error\b/g, '');
             if (selectedCell.element.className.indexOf('cell-editable') === -1) {
                selectedCell.element.className += ' cell-editable';
             }
             if (selectedCell.element.className.indexOf('cell-selected') === -1) {
                selectedCell.element.className += ' cell-selected';
             }
        }

        function clearNumber() {
            if (selectedCell.row === -1 || !selectedCell.element) {
                 setMessage("Please select an empty cell first.");
                 return;
            }
            if (currentPuzzle[selectedCell.row][selectedCell.col] !== 0) {
                 setMessage("Cannot clear initial puzzle numbers.");
                return;
            }
            userBoard[selectedCell.row][selectedCell.col] = 0;
            selectedCell.element.innerHTML = '';
            selectedCell.element.className = selectedCell.element.className.replace(/\bcell-error\b/g, '');
             if (selectedCell.element.className.indexOf('cell-editable') === -1) {
                selectedCell.element.className += ' cell-editable';
             }
             if (selectedCell.element.className.indexOf('cell-selected') === -1) {
                selectedCell.element.className += ' cell-selected';
             }
        }

        function checkSolution() {
            if (!userBoard || !currentPuzzle) {
                setMessage("Start a new game first.");
                return;
            }
            var errorsFound = false;
            var isComplete = true;
            var table = document.getElementById('sudoku-grid');
            var rows = table.getElementsByTagName('tr');
            var cells = table.getElementsByTagName('td');
             for (var i = 0; i < cells.length; i++) {
                 var currentClasses = cells[i].className.split(' ');
                 var newClasses = [];
                 for (var j = 0; j < currentClasses.length; j++) {
                     if (currentClasses[j] !== 'cell-error') {
                         newClasses.push(currentClasses[j]);
                     }
                 }
                 cells[i].className = newClasses.join(' ');
             }
            for (var r = 0; r < SIZE; r++) {
                for (var c = 0; c < SIZE; c++) {
                    var cellValue = userBoard[r][c];
                    var tdElement = rows[r].getElementsByTagName('td')[c];
                    if (cellValue === 0) {
                        isComplete = false;
                    } else if (currentPuzzle[r][c] === 0) {
                         var originalValue = userBoard[r][c];
                         userBoard[r][c] = 0;
                         if (!isValid(userBoard, r, c, originalValue)) {
                             errorsFound = true;
                             if (tdElement.className.indexOf('cell-error') === -1) {
                                 tdElement.className += ' cell-error';
                             }
                             tdElement.className = tdElement.className.replace(/\bcell-editable\b/g, '');
                             tdElement.className = tdElement.className.replace(/\bcell-selected\b/g, '');
                         }
                         userBoard[r][c] = originalValue;
                    }
                }
            }
            if (errorsFound) {
                setMessage("Errors found (marked). Keep trying!");
            } else if (!isComplete) {
                setMessage("Looking good so far, but not complete yet.");
            } else {
                var correct = true;
                 if (!currentSolution) {
                     setMessage("Error: Solution data missing.");
                     return;
                 }
                for(var r=0; r<SIZE; r++){
                    for(var c=0; c<SIZE; c++){
                        if(userBoard[r][c] !== currentSolution[r][c]){
                            correct = false;
                             var tdElement = rows[r].getElementsByTagName('td')[c];
                             if (tdElement.className.indexOf('cell-error') === -1) {
                                 tdElement.className += ' cell-error';
                             }
                             tdElement.className = tdElement.className.replace(/\bcell-editable\b/g, '');
                             tdElement.className = tdElement.className.replace(/\bcell-selected\b/g, '');
                        }
                    }
                }
                if(correct){
                     setMessage("Congratulations! Puzzle Solved Correctly!");
                     clearSelection();
                } else {
                     setMessage("Puzzle complete, but some numbers are incorrect (marked).");
                     errorsFound = true;
                }
            }
        }

        // --- Game Initialization ---
        function startGame() {
            var difficultySelect = document.getElementById('difficulty');
            var selectedDifficulty = difficultySelect.options[difficultySelect.selectedIndex].value;
            generatePuzzle(selectedDifficulty);
        }

        window.onload = function() {
             renderEmptyGridFrame();
        };

    </script>

</body>
</html>